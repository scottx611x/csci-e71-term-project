# Docker on Travis needs sudo
sudo: True

before_script:
  - pushd app-context
  - cp .env.example .env
  - docker run --rm -v $(pwd):/app composer/composer install
  - popd

  - pushd docker-context
  # Run our services in a detached manner
  - docker-compose up -d 
  - docker-compose exec -T app php artisan key:generate
  - docker-compose exec -T app php artisan optimize

script:
  - docker-compose exec -T app vendor/bin/phpmd app text codesize design naming unusedcode
  - docker-compose exec -T app vendor/bin/phpunit --testdox --coverage-text tests --coverage-clover=coverage.xml
  - popd

after_success:
  - bash <(curl -s https://codecov.io/bash)

notifications:
  notifications:
    slack: agilesoftwarecourse:s88h27xWCEDdojbTRgquomEv
  on_success: never
